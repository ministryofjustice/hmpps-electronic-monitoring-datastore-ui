{% extends "../partials/layout.njk" %}

{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}
{%- from "moj/components/pagination/macro.njk" import mojPagination -%}
{% from  "../components/emsDateFilter.njk" import emsDateFilter %}
{% from  "../components/emsSortableTable.njk" import emsSortableTable %}

{% set pageTitle = applicationName + " - Order details" %}
{% set mainClasses = "app-container govuk-body" %}

{% set mockData = {
  order_details: {
    legacy_subject_id: "1234567",
    name: "John Smith",
    alias: "Zeno",
    date_of_birth: "01-02-1980",
    postcode: "ABC 123",
    address_1: "1 Primary Street",
    address_2: "Sutton",
    address_3: "London",
    tag_type: "Alcohol tag",
    start_date: "01-02-2012",
    end_date: "03-04-2013"
  },
  subject_history_report: {
    report_url: "#", 
    name: "1234567",
    created_on: "01-02-2020",
    time: "0900"
  },
  urls: {
    back: "#",
    order_details: "#",
    visits_and_tasks: "#",
    event_hsitory: "#",
    equipment_details: "#",
    curfew_hours: "#",
    curfew_violations: "#",
    contact_history: "#",
    suspensions: "#"
  },
  documents: {
    page_size: 2,
    order_documents: [
      {
        name: "Document 1",
        url: "#",
        created_on: "01-02-2020",
        time: "0900",
        notes: "Order 1 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 2",
        url: "#",
        created_on: "21-09-2017",
        time: "1200",
        notes: "Order 2 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 3",
        url: "#",
        created_on: "08-04-2021",
        time: "1000",
        notes: "Order 3 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 4",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 4 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 5",
        url: "#",
        created_on: "04-09-2011",
        time: "2100",
        notes: "Order 5 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 6",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 6 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 7",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 7 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 8",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 8 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 9",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 9 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 10",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 10 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 11",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 11 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 12",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 12 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 13",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 13 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      },
      {
        name: "Document 14",
        url: "#",
        created_on: "09-12-2002",
        time: "1700",
        notes: "Order 14 documents xxxxxx xxxxxxx NAME HDC New.msg application/octet-stream NAME - TOLD TO IGNORE AS SUBJECT STILL IN CUSTODY ABCD 12 345678 xx-xxxxxx"
      }
    ]
  }
} %}

{% set orderDetails = mockData.order_details %}
{% set urls = mockData.urls %}
{% set subjectHistory = mockData.subject_history_report %}

{% set orderDocuments = [] %}
{% for document in mockData.documents.order_documents %}
  {% set orderDocuments = orderDocuments.concat(
    [[
      {
        html: '
          <a href="' + document.url + '">
            '+ document.name +'
          </a>
        ',
        attributes: {
            "data-sort-value": document.name
        }
      },
      {
        text: document.created_on,
        attributes: {
          "data-sort-value": document.created_on.split('-')[2] ~ document.created_on.split[1] ~ document.created_on.split[0]
        }
      },
      {
        text: document.time,
        attributes: {
          "data-sort-value": document.time
        }
      },
      {
        text: "See notes +"
      }
    ]]
  ) %}
{% endfor %}

{% block content %}

  {{ govukBackLink({
    text: "refine search",
    href: back_url
  }) }}

  {{ govukWarningText({
    text: "This service gives you access to all case data that was held by Capita and G4S from [date] to [date]",
    iconFallbackText: "Warning",
    classes: "service-information"
  }) }}

  {{ govukTable({
    caption: "Key order details",
    captionClasses: "govuk-table__caption--m",
    firstCellIsHeader: true,
    rows: [
      [
        {
          text: "Legacy subject ID"
        },
        {
          text: orderDetails.legacy_subject_id
        }
      ],
      [
        {
          text: "Name"
        },
        {
          text: orderDetails.name
        }
      ],
      [
        {
          text: "Alias"
        },
        {
          text: orderDetails.alias
        }
      ],
      [
        {
          text: "Date of birth"
        },
        {
          text: orderDetails.date_of_birth
        }
      ],
      [
        {
          text: "Postcode"
        },
        {
          text: orderDetails.postcode
        }
      ],
      [
        {
          text: "Address"
        },
        {
          html: ' <span>'
            + orderDetails.address_1
            + (('<br/>' + orderDetails.address_2) if orderDetails.address_2 else '')
            + (('<br/>' +  orderDetails.address_3) if orderDetails.address_3 else '')
          + '</span>'
        }
      ],
      [
        {
          text: "Tag type"
        },
        {
          text: orderDetails.tag_type
        }
      ],
      [
        {
          text: "Start date"
        },
        {
          text: orderDetails.start_date
        }
      ],
      [
        {
          text: "End date"
        },
        {
          text: orderDetails.end_date
        }
      ]
    ]
  }) }}

  <div class="govuk-button-group ems-ui-button-grid">
    {{ govukButton({
      text: "Order details",
      href: urls.order_details,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Visits and tasks",
      href: urls.vistis_and_tasks,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Event history",
      href: urls.event_history,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Equipment details",
      href: urls.equipment_details,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Curfew hours",
      href: urls.curfew_hours,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Curfew violations",
      href: urls.curfew_violations,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Contact history",
      href: urls.contact_history,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}

    {{ govukButton({
      text: "Suspensions",
      href: urls.suspensions,
      classes: "govuk-button--secondary ems-ui-button-grid__button"
    }) }}
  </div>

  {{ govukTable({
    caption: "Subject history report",
    captionClasses: "govuk-table__caption--m",
    firstCellIsHeader: false,
    head: [
      {
        text: "Name"
      },
      {
        text: "Created on"
      },
      {
        text: "Time"
      }
    ],
    rows: [
      [
        {
          html: '
            <a href="' + subjectHistory.report_url + '">
              '+ subjectHistory.name +'
            </a>
          ' 
        },
        {
          text: subjectHistory.created_on
        },
        {
          text: subjectHistory.time
        }
      ]
    ]
  }) }}

  <h2 class="govuk-heading-m"> All documents </h2>

  {{ emsDateFilter() }}


  {% set orderDocumentsHtml %}
    {{ emsSortableTable(mockData.documents.order_documents, mockData.documents.page_size) }}
  {% endset %}

  {% set variationsHtml %}
    {{ govukTable({
      head: [
        {
          text: "Case manager"
        },
        {
          text: "Cases opened"
        },
        {
          text: "Cases closed"
        }
      ],
      rows: [
        [
          {
            text: "David Francis"
          },
          {
            text: "3"
          },
          {
            text: "0"
          }
        ],
        [
          {
            text: "Paul Farmer"
          },
          {
            text: "1"
          },
          {
            text: "0"
          }
        ],
        [
          {
            text: "Rita Patel"
          },
          {
            text: "2"
          },
          {
            text: "0"
          }
        ]
      ]
    }) }}
  {% endset -%}

  {% set enforcementsHtml %}
    {{ govukTable({
      head: [
        {
          text: "Case manager"
        },
        {
          text: "Cases opened"
        },
        {
          text: "Cases closed"
        }
      ],
      rows: [
        [
          {
            text: "David Francis"
          },
          {
            text: "98"
          },
          {
            text: "95"
          }
        ],
        [
          {
            text: "Paul Farmer"
          },
          {
            text: "122"
          },
          {
            text: "131"
          }
        ],
        [
          {
            text: "Rita Patel"
          },
          {
            text: "126"
          },
          {
            text: "142"
          }
        ]
      ]
    }) }}
  {% endset -%}

  {% set visitReportsHtml %}
    {{ govukTable({
      head: [
        {
          text: "Case manager"
        },
        {
          text: "Cases opened"
        },
        {
          text: "Cases closed"
        }
      ],
      rows: [
        [
          {
            text: "David Francis"
          },
          {
            text: "1380"
          },
          {
            text: "1472"
          }
        ],
        [
          {
            text: "Paul Farmer"
          },
          {
            text: "1129"
          },
          {
            text: "1083"
          }
        ],
        [
          {
            text: "Rita Patel"
          },
          {
            text: "1539"
          },
          {
            text: "1265"
          }
        ]
      ]
    }) }}
  {% endset -%}

  {{ govukTabs({
    items: [
      {
        label: "Order documents",
        id: "order-documents",
        panel: {
          html: orderDocumentsHtml
        }
      },
      {
        label: "Variations",
        id: "variations",
        panel: {
          html: variationsHtml
        }
      },
      {
        label: "Enforcements",
        id: "enforcements",
        panel: {
          html: enforcementsHtml
        }
      },
      {
        label: "Visit reports",
        id: "visit-reports",
        panel: {
          html: visitReportsHtml
        }
      }
    ]
  }) }}

{% endblock %}
